<% content_for :page_specific_javascript_late do %>
<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script>
  /*
   * Google Maps documentation: http://code.google.com/apis/maps/documentation/javascript/basics.html
   * Geolocation documentation: http://dev.w3.org/geo/api/spec-source.html
   */
   $( document ).on( "pageinit", "#main-page", function() {
    var defaultLatLng = new google.maps.LatLng(34.0983425, -118.3267434);  // Default to Hollywood, CA when no geolocation support
    if ( navigator.geolocation ) {
      function success(pos) {
        // Location found, show map with these coordinates
        drawMap(new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude));
      }
      function fail(error) {
        drawMap(defaultLatLng);  // Failed to find location, show default map
      }
      // Find the users current position.  Cache the location for 5 minutes, timeout after 6 seconds
      navigator.geolocation.getCurrentPosition(success, fail, {maximumAge: 500000, enableHighAccuracy:true, timeout: 20000});
    } else {
      drawMap(defaultLatLng);  // No geolocation support, show default map
    }
    function drawMap(latlng) {
      var myOptions = {
        zoom: 10,
        center: latlng,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };
      var map = new google.maps.Map(document.getElementById("map-canvas"), myOptions);
      // Add an overlay to the map of current lat/lng
      var user_marker = new google.maps.Marker({
        position: latlng,
        map: map,
        animation: google.maps.Animation.DROP,
        title: ""
      });
      google.maps.event.addListener(user_marker, 'click', toggleBounce);
      function toggleBounce() {
        if (user_marker.getAnimation() != null) {
          user_marker.setAnimation(null);
        } else {
          user_marker.setAnimation(google.maps.Animation.DROP);
        }
      }

    }
  });
</script>
<% end %>
<%= render :partial => "navbar" %>
<div id="map-canvas" style="width:100%;height:450px;"></div> 
<ul data-role="listview" data-filter="true" data-filter-placeholder="Buscar..." data-inset="true">
  <% @hotels.each do |hotel| %>
  <li >
    <a href="<%= hotel_path hotel  %>">
      <%= image_tag(hotel.hotel_photos.first.photo.thumb.url) if hotel.hotel_photos.present? %>
      <h2><%= hotel.name %></h2>
      <p><%= hotel.description.truncate(100, separator: ' ') %></p>
    </a>
  </li>
  <% end %>
</ul>